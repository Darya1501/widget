(()=>{"use strict";const e=()=>{const e=document.querySelector(".video-control"),t=document.querySelector(".plus-left"),s=document.querySelector(".plus-right");let n=Number.parseInt(s.style.left)-Number.parseInt(t.style.left);const o=document.getElementById("pupil-distance");let i=62;const l=document.querySelector(".try-on"),a=document.getElementById("user-photo");function r(e){const t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}}t.onmousedown=function(o){const i=r(t),l=r(e),a=o.pageX-i.left,d=o.pageY-i.top;document.onmousemove=function(e){!function(e){t.style.left=e.pageX-a-l.left+"px",t.style.top=e.pageY-d+"px",s.style.left=e.pageX-a-l.left+n+"px",s.style.top=e.pageY-d+"px"}(e)},t.onmouseup=function(){document.onmousemove=null,t.onmouseup=null}},a.onmousedown=function(t){const s=r(a),n=r(e),o=t.pageX-s.left,i=t.pageY-s.top;a.style.position="absolute",document.onmousemove=function(e){!function(e){a.style.left=e.pageX-o-n.left+"px",a.style.top=e.pageY-i+"px"}(e)},a.onmouseup=function(){document.onmousemove=null,a.onmouseup=null}},o.addEventListener("keydown",(e=>{-1==="0123456789".indexOf(e.key)&&"Backspace"!==e.key&&e.preventDefault()})),o.addEventListener("input",(()=>{o.value>0&&o.value<100&&(n=n/i*+o.value,i=+o.value,s.style.left=parseInt(t.style.left)+n+"px")}));const d=document.getElementById("size");d.addEventListener("input",(()=>{a.style.width=+d.value+445+"px",a.style.height=+d.value+415+"px"}));const c=document.getElementById("rotation");c.addEventListener("input",(()=>{a.style.transform=`rotate(${c.value}deg)`})),l.addEventListener("click",(()=>{o.setAttribute("disabled",!0),d.setAttribute("disabled",!0),c.setAttribute("disabled",!0),l.style.display="none";const a=document.querySelector(".current-glasses").dataset.index;console.log("index: ",a),fetch("https://optimaxdev.github.io/volga-it/response.json").then((e=>{if(200!==e.status)throw new Error("Status network not 200");return e.json()})).then((t=>(e.insertAdjacentHTML("beforeend",`<img src="${t.items[a].mirror_frame}" id="result-glasses">`),t.items[a].width))).then((e=>{const o=document.getElementById("result-glasses");o.onload=function(){const l=this.width*(e/this.width/(i/n))+"px";o.style.width=l,o.style.top=Number.parseInt(t.style.top)-10+"px",o.style.left=Number.parseInt(t.style.left)-30+"px",t.style.display="none",s.style.display="none"}}))})),document.querySelector(".reset").addEventListener("click",(()=>{const e=document.getElementById("result-glasses");e.parentNode.removeChild(e),o.removeAttribute("disabled"),d.removeAttribute("disabled"),c.removeAttribute("disabled"),l.style.display="block"})),document.querySelector(".back").addEventListener("click",(()=>location.reload()))};(()=>{const t=document.getElementById("virtual-mirror-widget");t.classList.add("widget");let s='\n  <a href="https://optimax.dev/" class="widget__logo"><img src="./img/logo.svg" alt="logo"></a>\n  <div class="widget__img-container">\n    <img src="img/person-1.png" class="widget__person-photo">\n    <button class="widget__upload-button" id="upload-button"><img src="img/Camera.svg">Upload</button>\n  </div>\n';fetch("https://optimaxdev.github.io/volga-it/response.json").then((e=>{if(200!==e.status)throw new Error("Status network not 200");return e.json()})).then((n=>(((n,o)=>{const i=o[0];s+=`\n    <div class="widget__description current-glasses" data-index='0'>\n      <h3 class="current-glasses__name">${i.name}</h3>\n      <img src="${i.image}" class="current-glasses__img">\n      <a class="widget__button">Choose Lenses</a>\n      <h3 class="current-glasses__description-title">Product Description</h3>\n      <p class="current-glasses__description">${i.description}</p>\n    </div>\n  `,s+='\n      <div class="widget__adjust-image" style="display:none">\n        <button class="back">\n          <img src="img/arrow_left.svg" alt="" />Back\n        </button>\n        <h3>Adjust the Image</h3>\n        <ol>\n          <li>Drag the RED targets to the center of your eyes.</li>\n          <li>Drag to reposition photo</li>\n          <li>\n            Set your PD, if you know it (58-70).\n            <input type="text" placeholder="62" id="pupil-distance"/>\n          </li>\n          <li>Adjust the photo with the controls.</li>\n        </ol>\n        <div class="ranges">\n          <label for="size">Photo size: </label>\n          <input type="range" name="size" id="size" min="-50" max="50" value="0"/>\n          <label for="rotation">Photo rotation: </label>\n          <input type="range" name="rotation" id="rotation" min="-50" max="50" value="0"/>\n        </div>\n      </div>\n      <div class="reset-buttons" style="display:none">\n        <button class="try-on">Try On Glasses</button>\n        <button class="reset">Reset Adjastments</button>\n      </div>\n    ',s+='\n    <div class="widget__other-glasses other-glasses">\n      <h3 class="other-glasses__title">Similar Frames</h3>\n      <div class="other-glasses__slider">\n  ';for(let e=1;e<4;e++)s+=`\n      <div class="other-glasses__slide" data-index="${e}">\n        <img src="${o[e].image}">\n        <span class="other-glasses__name">${o[e].name}</span>\n      </div>\n    `;s+="</div></div>",t.innerHTML=s,document.getElementById("upload-button").addEventListener("click",(()=>{document.querySelector(".widget__logo").style.display="none";const t=document.querySelector(".widget__img-container");if(t.classList.add("access-control"),t.innerHTML="\n      <h3>Allow camera access</h3>\n      <span>We ask you to enable camera access so you can start trying on glasses.</span>\n    ",navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const s=445;let n=0,o=!1;t.classList.remove("access-control"),t.classList.add("video-control");const i='\n        <video id="video" autoplay></video>\n        <button id="snap" class="widget__upload-button"><img src="img/Camera.svg">Сделать снимок</button>\n        <canvas id="canvas" style="display: none;"></canvas>\n        <div class="photo-container widget__person-photo">\n        <img id="user-photo" style="width: 445px; height: 415px;"></div>\n      ';t.innerHTML=i,navigator.mediaDevices.getUserMedia({video:!0}).then((i=>{const l=document.getElementById("video");o||(n=l.offsetHeight/(l.offsetWidth/s),l.setAttribute("width",s),l.setAttribute("height",n),o=!0),l.srcObject=i,l.play();const a=document.getElementById("snap");a.addEventListener("click",(()=>{t.insertAdjacentHTML("beforeend",'<img class="plus-left plus" src="./img/plus.svg" style="left: 170px; top: 180px;">'),t.insertAdjacentHTML("beforeend",'<img class="plus-right plus" src="./img/plus.svg" style="left: 250px; top: 180px;">');const o=document.getElementById("canvas"),i=o.getContext("2d");o.setAttribute("width",s),o.setAttribute("height",n),l.style.display="none",i.drawImage(l,0,(n-334)/2,s,334);const r=o.toDataURL("image/png");document.getElementById("user-photo").setAttribute("src",r),l.pause(),a.style.display="none",document.querySelector(".current-glasses").style.display="none",document.querySelector(".other-glasses").style.display="none",document.querySelector(".widget__adjust-image").style.display="block",document.querySelector(".reset-buttons").style.display="block",e()}))}))}}))})(n.count,n.items),n.items))).then((e=>{document.querySelector(".other-glasses__slider").addEventListener("click",(t=>{const s=t.target;if(s.closest(".other-glasses__slide")){const t=s.closest(".other-glasses__slide").dataset.index,n=document.querySelector(".current-glasses");if(n.dataset.index!==t){n.dataset.index=t;const s=`\n              <h3 class="current-glasses__name">${e[t].name}</h3>\n              <img src="${e[t].image}" class="current-glasses__img">\n              <a class="widget__button">Choose Lenses</a>\n              <h3 class="current-glasses__description-title">Product Description</h3>\n              <p class="current-glasses__description">${e[t].description}</p>\n            `;n.innerHTML=s}}}))}))})()})();